(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();const b="modulepreload",I=function(t){return"/"+t},v={},O=function(e,i,n){let r=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(i.map(c=>{if(c=I(c),c in v)return;v[c]=!0;const u=c.endsWith(".css"),V=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${V}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":b,u||(l.as="script"),l.crossOrigin="",l.href=c,s&&l.setAttribute("nonce",s),document.head.appendChild(l),u)return new Promise((E,_)=>{l.addEventListener("load",E),l.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return r.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})};var W=function(t,e,i){if(i||arguments.length===2)for(var n=0,r=e.length,o;n<r;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))};function m(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(!t){var r=void 0;throw e===void 0?r=new Error("Invariant violation"):r=new Error(C.apply(void 0,W([e],i,!1))),r.name="InvariantViolation",r}}function C(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=0;return String(t).replace(/%s|%O/g,function(r){var o=e[n++];if(r==="%O")try{return JSON.stringify(o)}catch(a){return o}else return o})}const F=Date.now();let d,p,w;function M(t){w=t,d=h(t.localAppVersionStr);const e=A();e?window._pwaLoadedLatestScripts?t.loadMainScript():(console.warn(`[PWA] Found app version mismatch flag (${e}, local=${t.localAppVersionStr}), force loading of latest scripts...`),window._pwaLoadedLatestScripts=!0,window._pwaAppVersion=t.localAppVersionStr,window._pwaLoadLatestIndexScript=x(t.localAppVersionStr,t.loadMainScript),U(t.loadLatestIndexScriptUrl)):(setTimeout(function(){p||T()},5e3),t.loadMainScript())}function x(t,e){return function(i,n){const r=t===i;if(r||document.querySelector(`script[src="${n}"]`))console.debug("[PWA] Same %s",r?"version":"script"),L(),e();else{const o=document.createElement("script");o.type="module",o.src=n,o.defer=!0,o.setAttribute("crossorigin",""),document.head.appendChild(o)}}}function j(t){if(!t)return;const e=h(t);m(d),d[0]<e[0]?(console.warn("[PWA] Found major update, reloading app..."),P("major")):d[0]===e[0]&&d[1]<e[1]?(console.warn("[PWA] Found minor update"),y("minor")):p||(p=!0,(!window._pwaLoadedLatestScripts||window._pwaAppVersion===t)&&L())}const g="pwaAppVersionMismatch";let f;function A(){return localStorage.getItem(g)}function y(t){f!==t&&(localStorage.setItem(g,t),f=t)}function L(){f=void 0,localStorage.removeItem(g),console.info("[PWA] Removed app version mismatch flag")}let S=!1;function P(t){const e=Date.now()-F;if(y(t),!A()){console.error("[PWA] Set version flag failed!");return}if(window._pwaLoadedLatestScripts&&e<6e5){console.error("[PWA] Can not load the latest scripts");return}e>1e4&&!S&&(S=!0,alert(`New app updates found.
The page will reload to apply the latest version.`)),N()}async function N(){const t=w.getServiceWorkerUpdater();if(t){setTimeout(()=>{window.location.reload()},5e3);try{await t()}catch(e){console.error("[PWA] error: update service worker",e)}}else window.location.reload()}async function T(){const t=await fetch(w.versionApiUrl);if(t.status===200){const e=await t.json();m(d),h(e.version)[0]>d[0]&&(console.error("[PWA] Found major update, reloading app..."),P("major"))}}function U(t){const e=document.createElement("script");e.type="text/javascript",e.src=t,e.defer=!0,e.setAttribute("crossorigin",""),document.head.appendChild(e)}function h(t){const e=/^(\d+)\.(\d+)\.(\d+)$/.exec(t);return m(e),[Number(e[1]),Number(e[2]),Number(e[3])]}console.info('app:start version=%s, built="%s"',"20.3.0",new Date(1757124826267).toLocaleString());M({localAppVersionStr:"20.3.0",loadMainScript:()=>void O(()=>import("./main-Caapoe0n.js"),[]),loadLatestIndexScriptUrl:`/assets/index.js?t=${Date.now()}`,versionApiUrl:"/api/app-version",getServiceWorkerUpdater:()=>window._updateServiceWorker});export{O as _,j as c,m as i};
