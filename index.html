<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <title>RSS Web Reader</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>Login to RSS Reader</h2>
            <form id="loginForm" onsubmit="event.preventDefault(); login();">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <button onclick="signInWithGoogle()" class="google-btn">Sign in with Google</button>
            <p>Don't have an account? <a href="#" onclick="closeModal('loginModal'); document.getElementById('registerModal').style.display='block';">Register</a></p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h2>Register</h2>
            <form id="registerForm" onsubmit="event.preventDefault(); register();">
                <input type="email" id="registerEmail" placeholder="Email" required>
                <input type="password" id="registerPassword" placeholder="Password" required>
                <button type="submit">Register</button>
            </form>
            <p>Already have an account? <a href="#" onclick="closeModal('registerModal'); document.getElementById('loginModal').style.display='block';">Login</a></p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('settingsModal')">&times;</span>
            <h2>Settings</h2>
            <div class="settings-section">
                <h3>Appearance</h3>
                <label>
                    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()"> Dark Mode (AMOLED)
                </label>
            </div>
            <div class="settings-section">
                <h3>Reading</h3>
                <label>
                    <input type="checkbox" id="hideReadToggle" onchange="toggleHideRead(this.checked)"> Hide Read Articles
                </label>
            </div>
            <div class="settings-section">
                <h3>Feeds</h3>
                <button onclick="document.getElementById('opmlImport').click()">Import OPML</button>
                <input type="file" id="opmlImport" accept=".opml,.xml" style="display: none;" onchange="importOPML(this.files[0])">
                <button onclick="exportOPML()">Export OPML</button>
                <button onclick="syncAllFeeds(false)">Sync All Feeds</button>
            </div>
            <div class="settings-section">
                <h3>Account</h3>
                <button onclick="logout()" class="danger-btn">Logout</button>
            </div>
        </div>
    </div>

    <!-- Add Feed Modal -->
    <div id="addFeedModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addFeedModal')">&times;</span>
            <h2>Add New Feed</h2>
            <form id="addFeedForm" onsubmit="event.preventDefault(); addFeed();">
                <input type="url" id="feedUrl" placeholder="Feed URL" required>
                <select id="feedGroup">
                    <option value="">No Group</option>
                </select>
                <button type="submit">Add Feed</button>
            </form>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>RSS Reader</h1>
                <button onclick="toggleSettings()" title="Settings">‚öôÔ∏è</button>
            </div>

            <div class="sidebar-actions">
                <button onclick="document.getElementById('addFeedModal').style.display='block'" class="add-feed-btn">+ Add Feed</button>
                <button onclick="createGroup()" class="add-group-btn">+ New Group</button>
            </div>

            <div class="feed-list" id="feedList">
                <!-- Feeds will be rendered here -->
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Articles List Panel -->
            <section class="articles-panel" id="articlesPanel">
                <div class="panel-header">
                    <h2 id="panelTitle">All Articles</h2>
                    <button onclick="syncAllFeeds(false)" title="Refresh">üîÑ</button>
                </div>
                <div class="articles-list" id="articlesList">
                    <!-- Articles will be rendered here -->
                </div>
            </section>

            <!-- Article Reading Pane -->
            <section class="reading-pane" id="readingPane">
                <div class="reading-pane-empty">
                    <p>Select an article to read</p>
                </div>
                <article id="articleContent" style="display: none;">
                    <div class="article-header">
                        <h1 id="articleTitle"></h1>
                        <div class="article-meta">
                            <span id="articleSource"></span>
                            <span id="articleDate"></span>
                        </div>
                        <div class="article-actions">
                            <button onclick="toggleArticleRead()" id="markReadBtn">Mark as Read</button>
                            <select id="contentSourceSelector" onchange="changeContentSource(this.value)">
                                <option value="feed">Feed Text</option>
                                <option value="webpage">Webpage Text</option>
                                <option value="inline">Inline</option>
                            </select>
                            <a id="articleLink" href="#" target="_blank">Open Original</a>
                        </div>
                    </div>
                    <div class="article-body" id="articleBody">
                        <!-- Article content will be rendered here -->
                    </div>
                </article>
            </section>
        </main>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading-indicator" style="display: none;">
        <div class="spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
</body>
</html>
